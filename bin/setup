#!/usr/bin/env bash

bindir=$(cd -P -- "$(dirname -- "$0")" && pwd -P)
basedir="$bindir/.."
homedir="$homedir/home"

dependencies=(cp curl ln mkdir ruby pmset sudo)

for dependency in "${dependencies[@]}"
do
  :
  hash $dependency 2>/dev/null || {
    echo >&2 "$dependency is required.";
    exit 1;
  }
done

# Homebrew
hash brew 2>/dev/null || {
  ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
}

cat $basedir/brew/taps  | xargs brew tap
cat $basedir/brew/brews | xargs brew install
cat $basedir/brew/casks | xargs brew cask install

# Disable the sudden motion sensor since disks are solid-state.
sudo pmset -a sms 0

# Enable JavaScript compilation from the CLI.
hash jsc 2>/dev/null || {
  ln -s /System/Library/Frameworks/JavaScriptCore.framework/Versions/Current/Resources/jsc /usr/local/bin/jsc
}

# Pathogen
mkdir -p ~/.vim/autoload ~/.vim/bundle && \
curl -LSso ~/.vim/autoload/pathogen.vim https://tpo.pe/pathogen.vim

# Dotfiles
lsrc -d $homedir
rcup -v -d $homedir

# Change to ZSH
chsh -s /bin/zsh
